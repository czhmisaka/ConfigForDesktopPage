import{A as E,a$ as L,b0 as n,bs as y,aW as k,bR as B,b8 as o,ai as A,bn as I,bS as H,bG as q,a_ as p,a2 as P,I as r,J as h,Z as c,U as z,P as C,X as b}from"./index-51f9d840.js";import R from"./inputForm-4c1456c5.js";import K from"./screenInputform-56fdcfe0.js";import $ from"./infoTable-8a1ff552.js";import N from"./cardlist-dc97ff1e.js";import"./infoTableEdit-2a10a288.js";import"./hooks-d68a43b8.js";import"./iconPicker-a7b62dd4.js";import"./noData-3195cd4b.js";let O=0;function W(e,a){let t=null,s=0;return function(){const i=this,l=arguments,d=new Date().getTime();d-s>=a?(clearTimeout(t),e.apply(i,l),s=d):(clearTimeout(t),t=setTimeout(function(){e.apply(i,l),s=d},a))}}function U(e){o.checkTime("\u8868\u5355\u9AD8\u5EA6\u8BA1\u7B97");const a=e.$refs.mainBox,t=e.$refs.inputBox;if(a&&t){let s=0,i=-16;e.PageData.total&&(s=32),t.$el.offsetHeight?e.TableHeight=a.$el.offsetHeight-t.$el.offsetHeight-34-s-i:e.TableHeight=a.$el.offsetHeight-24-s-i}o.checkTime("\u8868\u5355\u9AD8\u5EA6\u8BA1\u7B97")}let v=W(U,200);const M=E({componentInfo:{labelNameCN:"\u641C\u7D22\u5217\u8868\u7EC4\u4EF6",key:"searchTable",description:"\u641C\u7D22\u5217\u8868\u7EC4\u4EF6\uFF0C\u53EF\u4EE5\u76D1\u542CbaseData\u5185\u7684\u53C2\u6570\u4F5C\u4E3A\u641C\u7D22\u4F20\u53C2\u6570\uFF0C\u652F\u6301\u5BF9\u63A5\u4E0D\u540C\u98CE\u683C\u7684\u8868\u5355\u641C\u7D22\u7EC4\u4EF6",gridInfo:{middle:L(9,8)}},propsDetail:{defaultQuery:{label:"\u521D\u59CB\u5316\u641C\u7D22\u503C",type:n.obj},searchFunc:{label:"\u641C\u7D22\u51FD\u6570",type:n.functionEditor},showItemTemplate:{label:"\u5C55\u793A\u5355\u5143\u6A21\u677F\u5217\u8868",type:n.array},searchItemTemplate:{label:"\u641C\u7D22\u5355\u5143\u6A21\u677F\u5217\u8868",type:n.array},searchKeyWithBaseData:{label:"\u9700\u8981\u8BFB\u53D6\u7684baseDataKey\u503C",type:n.array},pageConfig:{label:"\u5206\u9875\u914D\u7F6E",type:n.obj},btnList:{label:"\u6309\u94AE\u884C\u4E3A\u5217\u8868",type:n.array},autoSearch:{label:"\u81EA\u52A8\u641C\u7D22",type:n.boolean},modeChange:{label:"\u5C55\u793A\u5217\u8868\u548C\u5361\u7247\u6A21\u5F0F\u7684\u5207\u6362\u6309\u94AE",type:n.boolean},isCard:{label:"\u5C55\u793A\u5361\u7247\u6A21\u5F0F",type:n.boolean},cardFunc:{label:"\u5361\u7247\u6A21\u5F0F\u6E32\u67D3\u65B9\u5F0F",type:n.functionEditor},canSelect:{label:"\u662F\u5426\u53EF\u4EE5\u9009\u62E9\u5217\u8868\u9879",description:"\u9ED8\u8BA4\u4E3Atrue",type:n.boolean},selectedChangeFunc:{label:"\u9009\u62E9\u6539\u53D8\u65F6\u89E6\u53D1\u7684\u51FD\u6570",type:n.functionEditor}},baseProps:{autoSearch:!1,defaultQuery:{helloworld:"hello world"},searchFunc:e=>[e],canSelect:!0,showItemTemplate:[y("HELLO WORLD","helloworld")],searchItemTemplate:[y("HELLO WORLD","helloworld")],btnList:[]},watch:{baseData:{handler(e){this.searchKeyWithBaseData&&this.searchKeyWithBaseData.map(a=>{Object.keys(e).indexOf(a)>-1&&this.baseDataForCheck[a]!=e[a]&&(this.baseDataForCheck[a]=e[a],this.search())})},deep:!0,immediate:!0}},props:["defaultQuery","baseData","sizeUnit","detail","searchFunc","showItemTemplate","searchItemTemplate","searchKeyWithBaseData","btnList","canSelect","selectedChangeFunc","noTableEdit","autoSearch","pageConfig","load","modeChange","isCard","cardFunc","rowHeightKey","screenStatus"],components:{cardBg:k,inputForm:R,infoTable:$,sideDialogForm:B,cardList:N,screenInputform:K},data(){return{query:{},PageData:{pageSize:1e3},isLoading:!1,isReady:!1,selectedList:[],TableHeight:500,interval:null,baseDataForCheck:{},idRandom:O+=Math.random()}},async created(){o.checkTime("searchTable"),this.isReady=!1,await this.loadUserConfig(),await this.initData(),this.isReady=!0,this.$emit("ready"),o.checkTime("initData"),await this.search(),o.checkTime("initData")},async mounted(){const e=this,a={},t="searchTable_func_"+this.idRandom;a[t]=e.changeSize,window.addEventListener("resize",a[t]);let s=0;const i=setInterval(()=>{e.changeSize(),s++,s>10&&clearInterval(i)},50);o.checkTime("searchTable")},async unmounted(){const e=this,a={},t="searchTable_func_"+this.idRandom;a[t]=e.changeSize,window.removeEventListener("resize",a[t])},methods:{async loadUserConfig(){const e=await A().getPageConfig(this.detail.label);let a={rowHeightKey:32};if(e.showItemTemplate){const s=e.showItemTemplate;a.showItemTemplate=s.map(i=>(this.showItemTemplate.map(l=>{l.key==i.key&&l.label==i.label&&(i={...l,showAble:i.showAble})}),i))}e.rowHeightKey&&(a.rowHeightKey=e.rowHeightKey);let t={};t[this.detail.label]=a,I(this,t)},isCanSelect(){return this.canSelect!==!1},changeSize(){v(this)},async initData(){this.defaultQuery&&Object.keys(this.defaultQuery).length>0&&(this.query=H(this.defaultQuery))},queryChange(e){this.query=e,this.autoSearch&&this.search()},uploadChange(e){},refresh(){var e;if(this.autoSearch==!1&&(this==null?void 0:this.searchKeyWithBaseData)&&((e=this==null?void 0:this.searchKeyWithBaseData)==null?void 0:e.length)>0){let a={};this.searchKeyWithBaseData.map(s=>{a[s]={}}),q(this,a)}this.initData()},async btnClick(e,a){if(e.isLoading=!0,e.type==p.OpenDrawer)this.$modules.getModuleApi().userManage_openDrawerForm(this,e.drawerProps);else if((e.type==p.Function||e.type==p.UploadFunction||e.type==p.HoverFunction)&&e.function){let t=this;await e.function(t,{...a,_selectedList:this.selectedList})}else e.type==p.Url&&window.open(e.url);e.isLoading=!1},async selectedChange(e){this.selectedList=e,this.selectedChangeFunc&&await this.selectedChangeFunc(this,this.selectedList,this.PageData.data)},async search(e=this.query){this.query={...this.query,...e};let a=null;if(this.searchFunc&&this.isReady){this.isLoading=!0;try{if(o.checkTime("searchFunc"),a=await this.searchFunc(this.query,this),a){if(a.total||a.total==0){this.PageData.data=[];const t=a.list;this.PageData={...a,data:t,pageNumber:a.pageNum&&a.pageNum==0?1:a.pageNum}}else this.PageData.data=a;this.isLoading=!1}else this.PageData={data:[]};o.checkTime("searchFunc")}catch(t){console.error("\u3010searchTable\u3011\u7EC4\u4EF6search\u4E8B\u4EF6\u62A5\u9519",t,a)}finally{this.isLoading=!1}}}}});function Q(e,a,t,s,i,l){const d=r("screenInputform"),D=r("inputForm"),F=r("infoTable"),T=r("cardList"),S=r("el-pagination"),w=r("cardBg");return h(),c(w,{ref:"mainBox",cusStyle:{padding:"12px"}},{default:z(()=>{var m,f;return[e.screenStatus?(h(),c(d,{key:0,ref:"inputBox",query:e.query,onSearch:e.search,onRefresh:e.refresh,onBtnClick:e.btnClick,queryItemTemplate:e.searchItemTemplate,selectedList:e.selectedList,onInputChange:e.queryChange,"btn-list":e.btnList,autoSearch:e.autoSearch},null,8,["query","onSearch","onRefresh","onBtnClick","queryItemTemplate","selectedList","onInputChange","btn-list","autoSearch"])):(h(),c(D,{key:1,ref:"inputBox",query:e.query,onSearch:e.search,onRefresh:e.refresh,onBtnClick:e.btnClick,noTableEdit:e.noTableEdit,queryItemTemplate:e.searchItemTemplate,selectedList:e.selectedList,onInputChange:e.queryChange,"btn-list":e.btnList,modeChange:e.modeChange,autoSearch:e.autoSearch,isCard:e.isCard},null,8,["query","onSearch","onRefresh","onBtnClick","noTableEdit","queryItemTemplate","selectedList","onInputChange","btn-list","modeChange","autoSearch","isCard"])),e.isCard?e.isCard?(h(),c(T,{key:3,template:e.showItemTemplate,"data-list":(f=e.PageData)==null?void 0:f.data,loading:e.isLoading,canSelect:e.isCanSelect(),height:e.TableHeight,onSearch:e.search,onRefresh:e.refresh,style:C({height:e.TableHeight+"px"}),cardFunc:e.cardFunc,load:e.load,baseData:e.baseData,onSelectedChange:e.selectedChange,onOnChange:a[1]||(a[1]=(u,g)=>e.$emit("onChange",u,g))},null,8,["template","data-list","loading","canSelect","height","onSearch","onRefresh","style","cardFunc","load","baseData","onSelectedChange"])):b("",!0):(h(),c(F,{key:2,template:e.showItemTemplate,"data-list":(m=e.PageData)==null?void 0:m.data,loading:e.isLoading,rowHeightKey:e.rowHeightKey,canSelect:e.isCanSelect(),onSearch:e.search,onRefresh:e.refresh,style:C({height:e.TableHeight+"px"}),load:e.load,baseData:e.baseData,onSelectedChange:e.selectedChange,defalutSelectedList:e.selectedList,onOnChange:a[0]||(a[0]=(u,g)=>e.$emit("onChange",u,g))},null,8,["template","data-list","loading","rowHeightKey","canSelect","onSearch","onRefresh","style","load","baseData","onSelectedChange","defalutSelectedList"])),e.PageData.total?(h(),c(S,{key:4,style:{marginTop:"6px",float:"right"},"current-page":e.PageData.pageNumber,"onUpdate:currentPage":a[2]||(a[2]=u=>e.PageData.pageNumber=u),"page-size":e.PageData.pageSize,"onUpdate:pageSize":a[3]||(a[3]=u=>e.PageData.pageSize=u),"page-sizes":[5,10,20,30,40,100,200],small:!0,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:e.PageData.total,onSizeChange:a[4]||(a[4]=u=>e.search({pageSize:u})),onCurrentChange:a[5]||(a[5]=u=>e.search({pageNumber:u})),"hide-on-single-page":!1},null,8,["current-page","page-size","total"])):b("",!0)]}),_:1},512)}const ee=P(M,[["render",Q]]);export{ee as default};
