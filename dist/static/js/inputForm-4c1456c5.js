import{A as $,bc as L,aW as S,bO as q,a_ as f,aY as C,bn as B,bP as w,bd as O,bQ as P,a2 as E,I as u,J as a,K as d,O as p,U as n,Z as r,X as s,V as m,Q as V,R as v,P as A,W as g}from"./index-51f9d840.js";import{openTableEditor as R}from"./infoTableEdit-2a10a288.js";const U=P();let h=null;const N=$({name:"\u8868\u5355\u7EC4\u4EF6",props:["query","queryItemTemplate","queryItemConfig","btnList","autoSearch","selectedList","modeChange","isCard","noTableEdit"],watch:{query:{handler(e){this.refreshData(e)},deep:!0,immediate:!0},queryItemTemplate:{handler(e){this.initForm(e)},immediate:!0}},computed:{isNeedClose(){return!1}},components:{VueForm:L,cardBg:S,iconCell:q},data(){return{formData:{},uiSchema:{},formFooter:{show:!1},isOpen:!0,formProps:{layoutColumn:3,inlineFooter:!1,labelSuffix:"\uFF1A",labelPosition:"top",isMiniDes:!1,defaultSelectFirstOption:!0,labelWidth:"120px"},schema:{type:"object",properties:{}},btnActionTemplate:f,actionUrl:U,editFuncBtn:C("",f.Function,{function:async(e,o)=>{await R(e)}}),changeFuncBtn:C("",f.Function,{function:async(e,o)=>{B(e,{searchTable:{isCard:!e.isCard}})}})}},async mounted(){this.refreshData(this.query);let e=this;h&&clearInterval(h),h=setInterval(()=>{if(e.$refs.formBox&&e.$refs.formBox.$el){let o=e.$refs.formBox.$el.offsetWidth;o>600?e.formProps.layoutColumn=3:o>400?e.formProps.layoutColumn=2:e.formProps.layoutColumn=1}},100),await this.initForm(this.queryItemTemplate)},methods:{getDownLoadRequestHeaders(){return w()},async initForm(e=this.queryItemTemplate){Object.keys(this.query).length>0;let o={};o=await O(e,this,!1),this.schema.properties=o},onChange(){this.$emit("inputChange",this.formData)},handleSubmit(e){this.$emit("search",e)},btnClick(e,o){this.$emit("btnClick",e,o)},changeOpen(){this.isOpen=!this.isOpen,this.isOpen?this.initForm():this.initForm(this.queryItemTemplate.slice(0,this.formProps.layoutColumn))},refreshData(e){if(e===-1)this.formData={},this.$emit("inputChange",{}),this.$nextTick().then(()=>{this.handleSubmit()});else if(e&&Object.keys(e).length>0)for(let o in e)this.formData[o]!=e[o]&&(this.formData[o]=e[o]);else this.formData=e},addFileCreate(e){this.$emit("inputChange",e)},errorFile(e){this.$emit("inputChange",e)},exceedFile(e){this.$emit("inputChange",e)}}});const M={key:0},W={key:0,"slot-scope":"{ formData }",style:{textAlign:"right"}},j={key:0,class:"TopRight"};function H(e,o,z,Q,X,Y){const i=u("el-button"),k=u("el-upload"),D=u("VueForm"),F=u("iconCell"),T=u("cardBg");return e.queryItemTemplate&&e.queryItemTemplate.length>0||e.btnList&&e.btnList.length>0||!e.autoSearch||!e.noTableEdit?(a(),d("div",M,[p(T,{ref:"formBox",class:"formBox","cus-style":{padding:"0px",height:"auto",paddingBottom:e.btnList&&e.btnList.length>0||!e.autoSearch?"12px":"0px","border-radius":"6px",border:"0px solid",filter:"none","box-shadow":"none",display:"inline-block"}},{default:n(()=>[p(D,{modelValue:e.formData,"onUpdate:modelValue":o[4]||(o[4]=t=>e.formData=t),style:{textAlign:"left"},schema:e.schema,"ui-schema":e.uiSchema,formProps:e.formProps,onChange:e.onChange},{default:n(()=>[e.btnList&&e.btnList.length>0||!e.autoSearch||!e.noTableEdit?(a(),d("div",W,[e.noTableEdit?s("",!0):(a(),r(i,{key:0,class:"btn",type:"default",onClick:o[0]||(o[0]=t=>e.btnClick(e.editFuncBtn)),icon:"Setting"})),!e.autoSearch&&e.queryItemTemplate&&e.queryItemTemplate.length>0&&e.modeChange?(a(),r(i,{key:1,class:"btn",onClick:o[1]||(o[1]=t=>e.btnClick(e.changeFuncBtn)),icon:e.isCard?"Document":"Grid"},null,8,["icon"])):s("",!0),!e.autoSearch&&e.queryItemTemplate&&e.queryItemTemplate.length>0?(a(),r(i,{key:2,class:"btn",onClick:o[2]||(o[2]=t=>e.refreshData(-1)),icon:"RefreshRight"},{default:n(()=>[m("\u91CD\u7F6E")]),_:1})):s("",!0),e.autoSearch?s("",!0):(a(),r(i,{key:3,class:"btn",type:"primary",onClick:o[3]||(o[3]=t=>e.handleSubmit(e.formData)),style:{"margin-left":"0px"},icon:"Search"},{default:n(()=>[m("\u641C\u7D22")]),_:1})),(a(!0),d(V,null,v((e.btnList||[]).filter(t=>t&&t.isShow?t.isShow({...e.formData,_selectedList:e.selectedList},t):!0),(t,I)=>{var c;return a(),d("div",{key:I+"btn",class:"floatLeft",style:A(t.style?t.style:"")},[t.type==e.btnActionTemplate.UploadFunction?(a(),r(k,{key:0,ref_for:!0,ref:"uploadRef",headers:e.getDownLoadRequestHeaders(),class:"upload-demo",action:e.actionUrl+(t.uploadInfo?t.uploadInfo.action:""),limit:t.uploadInfo?t.uploadInfo.limit:1,data:t.uploadInfo?(c=t.uploadInfo)==null?void 0:c.data:{},"on-success":(l,y,b)=>e.btnClick(t,l),"on-error":(l,y,b)=>e.btnClick(t,l),"on-exceed":(l,y,b)=>e.btnClick(t,l),"show-file-list":!1},{default:n(()=>[p(i,{plain:"",icon:"plus",type:"primary"},{default:n(()=>[m(g(t.label),1)]),_:2},1024)]),_:2},1032,["headers","action","limit","data","on-success","on-error","on-exceed"])):(a(),r(i,{key:1,loading:t.isLoading,onClick:l=>e.btnClick(t),disabled:t.isDisable({...e.formData,_selectedList:e.selectedList},t),type:t.elType?typeof t.elType!="string"?t.elType(e.formData):t.elType:"",icon:t.icon},{default:n(()=>[m(g(t.label),1)]),_:2},1032,["loading","onClick","disabled","type","icon"]))],4)}),128))])):s("",!0)]),_:1},8,["modelValue","schema","ui-schema","formProps","onChange"]),e.isNeedClose?(a(),d("div",j,[p(F,{name:e.isOpen?"ArrowDownBold":"ArrowUpBold",onClick:e.changeOpen,iconOption:{fontSize:"12px"}},null,8,["name","onClick"])])):s("",!0)]),_:1},8,["cus-style"])])):s("",!0)}const K=E(N,[["render",H],["__scopeId","data-v-364542cc"]]);export{K as default};
